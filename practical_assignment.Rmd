---
title: "Regression"
author: "Anders Christensen, Anna Damkj√¶r Laksafoss and Stefan Bruhn Rasmussen"
date: "February 21, 2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(eval = FALSE)
```


```{r read_data, include=FALSE}
fullrun <- TRUE
if (fullrun) {
  narwhal <- readRDS("outputs/narwhal.RDS")
} else {
  narwhal <- readRDS("outputs/narwhal_reduced.RDS")
}
```



In this report we will attempt to understand if the whales are affected by the presence of the seismic ship. We will be considering the following valiables as measures of the whales behaviour

* `Depth`: Depth of the whale in meters belows sea level
* `Call`: Whether a whale makes a call
* `Click`: Wheter a whale makes a click
* `Buzz`: Whether a whale makes a buzz
* `ODBA`: Overall dynamic body acceleration
* `VeDBA`: Vector dynamic body acceleration
* `Strokerate`: Strokrate of tail of the whale

These variables are all potential response variables or will be used to create response variable. 

## Data clean up
Before we can analyse the data we must clean up the data. From the description of the data in the problem description we can make the following initial changes:

* Combine `Date` and `Hour` to a new single time object called `Datetime`.
* Correct for positve `Depths` by substracting maximum value from all values
* Encode -1 as NA for those variables, where it applies

The data set contains 1.058.507 data lines of which 780.853 data lines has missing values. The variables with missing values are `Dist.to.Paamiut`, `Dist.to.shore`, `ODBA`, `VeDBA`, `Lat`, `Long` and `Strokerate`. To handle the missing values we do the following:

* `Dist.to.Paamiut`: 770.877 missing values. **DESCRIPTION**
* `Dist.to.shore`: 30.009 missing values. **DESCRIPTION**
* `ODBA` and `VeDBA`: 7 missing values. **DESCRIPTION**
* `Lat` and `Long`: 10.882 missing values. **DESCRIPTION**
* `Strokerate`: 693 missing values. **DESCRIPTION**

Lastly there are a few issues of duplicate data lines. **WHICH ONES AND WHAT DID WE DO**


## Exploratory analysis
Now that data is complete we can take a more detailed look at the individual variables. As the dataset consits of 21 variables, we will plot and analyze these variables in groups. 


### The potential response variables
Let us first look at our potential respons variables. 

```{r sum_response}
summary(narwhal[,c("Depth", "ODBA", "VeDBA", "Strokerate", "Call", "Click", "Buzz")])
```

**HERE WE WILL ALSO BE ADDING NEW VARIABLES** :  



*Removing variables and observarions*: We can remove variables from the data, as some variables describe the same phenomena. 

* `ODBA` and `VeDBA` both describe the body acceleration of the whales and the two variables are extremly correlated with a correlation coefficient of 0.995. We remove the variable `VeDBA` from the data set.
* `Call`, `Buzz`, `Click` ------ **WILL WE BE REMOVING THESE**

![](figs/depthtimeplot.png)


### The categorical explanatory variables
```{r sum_cat_explanatory}
summary(narwhal[,c("Seismik", "Phase", "Area", "Acou.qua", "Ind", "Los")])
```


### The numeric explanatory variables
```{r sum_num_explanatory}
summary(narwhal[,c("Dist.to.Paamiut", "Dist.to.shore", "Lat", "Long")])
```

![](figs/numerical_densities.png)

Vi ser at

* Strokerate er "hakket" fordi det kun er integers

![](figs/locationplot.png)

```{r summaries}
summary(narwhal[,c(3:19)])
table(narwhal[,c("Ind","Phase")])
```




### Ideas/Thoughts

* Make a binary *Phase* variable with level *T* and *I*
* Partion binary variables (such as *Calls*) into intervals (e.g. 30 second intervals around each call)
* Make A binary *Diving* variable by partioning the Depth variable.
* Pay attention to *Data leakage* (When you predict something using data which is not availiable at prediction time.)
* Make correlation plot
* Area is likely just a Long and Lat with broader categories
* Should we use both whales? Given that one of the appears only in some trials 